<!-- AI ChatWorks - Complete Unified UI HTML - Enhanced Version -->
<div id="ai-chatworks-unified-window-overlay" class="modal-overlay ai-chatworks-scope">
    <div class="modal-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <img id="sidebar-logo-img" class="sidebar-logo" src="" alt="AI ChatWorks Logo">
                <h1 class="sidebar-title">AI ChatWorks</h1>
                <button class="sidebar-collapse-toggle" title="Toggle Sidebar" aria-label="Toggle sidebar"
                    aria-expanded="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        aria-hidden="true">
                        <polyline points="11 17 6 12 11 7"></polyline>
                        <polyline points="18 17 13 12 18 7"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Main Navigation Container -->
            <div class="view-switcher-container">
                <!-- Fixed Top Navigation -->
                <div class="sidebar-fixed-top">
                    <a href="#" data-view="prompts" data-tooltip="All Prompts" class="view-switcher active">
                        <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="m16 6 4 14"></path>
                            <path d="M12 6v14"></path>
                            <path d="M8 8v12"></path>
                            <path d="M4 4v16"></path>
                        </svg>
                        <span class="folder-name-text">All Prompts</span>
                    </a>
                    <a href="#" data-folder-id="favorites" data-tooltip="Favorites" class="view-switcher folder-link">
                        <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <span class="folder-name-text">Favorites</span>
                    </a>
                    <a href="#" data-folder-id="recents" data-tooltip="Recents" class="view-switcher folder-link">
                        <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        <span class="folder-name-text">Recents</span>
                    </a>
                </div>

                <!-- Divider -->
                <hr class="sidebar-divider">

                <!-- Scrollable Folder Container -->
                <div id="unified-folder-list-container" class="folder-list-container">
                    <!-- Sticky Folder Header -->
                    <div class="folders-header">
                        <span class="folders-title-text">FOLDERS</span>
                        <div class="folder-actions">
                            <button id="unified-new-folder-btn" class="new-folder-btn" title="New Folder"
                                aria-label="Create new folder">+</button>
                            <button id="folder-collapse-toggle" class="folder-collapse-toggle" title="Toggle Folders"
                                aria-label="Toggle folder list" aria-expanded="true">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- Folder List (populated dynamically) -->
                    <div id="unified-folder-list" class="folder-list">
                        <!-- Folders inserted here via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="sidebar-footer">
                <a href="#" data-view="settings" data-tooltip="Settings" class="view-switcher">
                    <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span class="folder-name-text">Settings</span>
                </a>
                <a href="#" data-view="help" data-tooltip="Help & Support" class="view-switcher">
                    <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="folder-name-text">Help & Support</span>
                </a>
                <div class="version-info" data-view="changelog" title="View Changelog">Version 1.2.0</div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Prompts View -->
            <div id="prompts-view" class="view-pane">
                <!-- Header -->
                <div class="prompt-library-header">
                    <h2 id="prompt-library-title">
                        All Prompts
                    </h2>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <!-- Avatar Button -->
                        <button id="user-avatar-btn"
                            style="width: 34px; height: 34px; border-radius: 6px; border: none; background: #3b82f620; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: all 0.2s ease; padding: 0;"
                            title="Account & Sync">
                            ðŸ”µ
                        </button>
                        <button class="new-prompt-button" id="new-prompt-btn-header">
                            <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            New Prompt
                        </button>
                    </div>
                </div>

                <hr class="content-divider">

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-field" id="library-search-field">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" placeholder="Search prompts..." id="library-search-input">
                    </div>
                    <div class="filter-controls">
                        <select id="prompt-sort" class="styled-select" title="Sort">
                            <option value="created-desc">Newest First</option>
                            <option value="created-asc">Oldest First</option>
                            <option value="usage-desc">Most Used</option>
                            <option value="name-asc">Name A-Z</option>
                            <option value="name-desc">Name Z-A</option>
                        </select>
                        <div class="view-toggles">
                            <button id="view-compact" class="layout-btn active" title="Compact View">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="3" y="3" width="7" height="7" rx="1" />
                                    <rect x="14" y="3" width="7" height="7" rx="1" />
                                    <rect x="3" y="14" width="7" height="7" rx="1" />
                                    <rect x="14" y="14" width="7" height="7" rx="1" />
                                </svg>
                            </button>
                            <button id="view-list" class="layout-btn" title="List View">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="8" y="5" width="13" height="2" />
                                    <rect x="8" y="11" width="13" height="2" />
                                    <rect x="8" y="17" width="13" height="2" />
                                    <rect x="2" y="5" width="2" height="2" />
                                    <rect x="2" y="11" width="2" height="2" />
                                    <rect x="2" y="17" width="2" height="2" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <hr class="content-divider">

                <!-- Prompt Grid -->
                <div class="prompt-grid" id="prompt-cards-grid">
                    <!-- Prompts inserted here -->
                </div>

                <!-- Footer with Breadcrumb -->
                <div class="prompt-library-footer">
                    <!-- Breadcrumb populated by JavaScript -->
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view-pane hidden"></div>

            <!-- Help View -->
            <div id="help-view" class="view-pane hidden"></div>

            <!-- Changelog View -->
            <div id="changelog-view" class="view-pane hidden"></div>

            <!-- Troubleshooting View -->
            <div id="troubleshooting-view" class="view-pane hidden"></div>
        </main>
    </div>

    <!-- ========================================
         TEMPLATES - ENHANCED VERSION
         ======================================== -->

    <!-- Folder Link Template -->
    <template id="folder-link-template">
        <a href="#" class="folder-link" data-folder-id="" data-tooltip="">
            <svg class="view-icon folder-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                fill="currentColor">
                <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" />
            </svg>
            <span class="folder-name-text">Folder Name</span>
            <button class="folder-options-btn" data-folder-id="" data-folder-name="" data-folder-color=""
                aria-label="Folder options">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path
                        d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z" />
                </svg>
            </button>
        </a>
    </template>

    <!-- Prompt Card Template -->
    <template id="prompt-card-template">
        <div class="prompt-card">
            <div class="prompt-card-header">
                <h3 class="prompt-card-title">Prompt Title</h3>
                <span class="prompt-date">Date</span>
            </div>
            <div class="prompt-card-content">
                <p>Prompt content preview...</p>
            </div>
            <div class="prompt-card-footer">
                <span class="prompt-card-folder"></span>
                <div class="card-actions-wrapper">
                    <button title="Paste" class="prompt-action-btn paste-btn" aria-label="Paste prompt">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            aria-hidden="true">
                            <path
                                d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z" />
                        </svg>
                    </button>
                    <div class="more-actions-container">
                        <button title="More options" class="prompt-action-btn more-actions-trigger"
                            aria-label="More options">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                            </svg>
                        </button>
                        <div class="more-actions-menu">
                            <button class="menu-action-btn edit-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                                </svg> Edit</button>
                            <button class="menu-action-btn duplicate-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                </svg> Duplicate</button>
                            <button class="menu-action-btn star-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg> Favorite</button>
                            <div class="menu-divider"></div>
                            <div class="menu-action-item has-submenu move-to-item">
                                <button class="menu-action-btn move-to-btn"><span class="menu-btn-content-wrapper"><svg
                                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                                        </svg> <span>Move To</span></span><svg class="submenu-arrow"
                                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                            clip-rule="evenodd" />
                                    </svg></button>
                                <div class="submenu"></div>
                            </div>
                            <div class="menu-divider"></div>
                            <button class="menu-action-btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 6h18" />
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                    <line x1="10" y1="11" x2="10" y2="17" />
                                    <line x1="14" y1="11" x2="14" y2="17" />
                                </svg> Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Prompt Row Template -->
    <template id="prompt-row-template">
        <div class="prompt-row">
            <div class="prompt-name">Prompt Name</div>
            <div class="prompt-content">Prompt content preview...</div>
            <div class="prompt-folder">Folder</div>
            <div class="prompt-date">Date</div>
            <div class="prompt-actions">
                <button class="icon-btn paste-btn" title="Paste" aria-label="Paste prompt">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path
                            d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z" />
                    </svg>
                </button>
                <div class="more-actions-container">
                    <button class="icon-btn more-actions-trigger" title="More" aria-label="More options">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"
                            aria-hidden="true">
                            <path
                                d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z" />
                        </svg>
                    </button>
                    <div class="more-actions-menu">
                        <button class="menu-action-btn edit-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                            </svg> Edit</button>
                        <button class="menu-action-btn duplicate-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                            </svg> Duplicate</button>
                        <button class="menu-action-btn star-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path
                                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                            </svg> Favorite</button>
                        <div class="menu-divider"></div>
                        <div class="menu-action-item has-submenu move-to-item">
                            <button class="menu-action-btn move-to-btn"><span class="menu-btn-content-wrapper"><svg
                                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                                    </svg> <span>Move To</span></span><svg class="submenu-arrow"
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd" />
                                </svg></button>
                            <div class="submenu"></div>
                        </div>
                        <div class="menu-divider"></div>
                        <button class="menu-action-btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                            </svg> Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- ENHANCED Confirm Dialog Template -->
    <template id="confirm-dialog-template">
        <div class="prompt-dialog confirm-dialog">
            <div class="prompt-dialog-header">
                <h3 class="dialog-title">Confirm</h3>
                <button class="prompt-dialog-close" aria-label="Close dialog">&times;</button>
            </div>
            <div class="prompt-dialog-body">
                <p class="dialog-message">Are you sure?</p>
                <span class="dialog-warning"></span>
            </div>
            <div class="prompt-dialog-footer">
                <button class="prompt-btn prompt-btn-secondary cancel-button">Cancel</button>
                <button class="prompt-btn ok-button">OK</button>
            </div>
        </div>
    </template>

    <!-- Folder Editor Dialog Template -->
    <template id="folder-editor-dialog-template">
        <div class="modal new-folder-modal prompt-dialog">
            <div class="top-bar">
                <h2 class="dialog-title">New Folder</h2>
                <button class="dialog-close-btn" aria-label="Close dialog">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <hr class="divider" />
            <div class="prompt-form-group">
                <label class="name-label" for="dialog-name-input">Name</label>
                <input class="name-input" id="dialog-name-input" maxlength="12" value="" aria-label="Folder name" />
                <div class="char-count name-count">0 / 12</div>
            </div>
            <div class="prompt-form-group">
                <label>Folder Color</label>
                <div class="color-picker"></div>
            </div>
            <div class="actions">
                <button class="cancel-button">Cancel</button>
                <button class="save-button">Save</button>
            </div>
        </div>
    </template>

    <!-- Prompt Editor Dialog Template -->
    <template id="prompt-editor-dialog-template">
        <div class="modal new-prompt-modal prompt-dialog">
            <div class="top-bar">
                <h2 class="dialog-title">New Prompt</h2>
                <div id="prompt-top-controls">
                    <button class="favorite favorite-button" title="Favorite" aria-label="Toggle favorite">â˜†</button>
                    <div class="folder-select-container"></div>
                </div>
            </div>
            <hr class="divider" />
            <div class="prompt-form-group">
                <label class="name-label" for="dialog-name-input">Name</label>
                <input class="name-input" id="dialog-name-input" maxlength="16" value="" aria-label="Prompt name" />
                <div class="char-count name-count">0 / 16</div>
            </div>
            <div class="prompt-form-group">
                <label class="content-label" for="dialog-content-input">Content</label>
                <textarea class="content-input" id="dialog-content-input" maxlength="10000"
                    aria-label="Prompt content"></textarea>
                <div class="char-count content-count">0 / 10000</div>
            </div>
            <div class="actions">
                <button class="cancel-button">Cancel</button>
                <button class="save-button">Save</button>
            </div>
        </div>
    </template>

    <!-- ENHANCED Folder Delete Options Dialog Template -->
    <template id="folder-delete-options-dialog-template">
        <div class="prompt-dialog confirm-dialog delete-options-dialog">
            <div class="prompt-dialog-header">
                <h3 class="dialog-title">Delete Folder</h3>
                <button class="prompt-dialog-close" aria-label="Close dialog">&times;</button>
            </div>
            <div class="prompt-dialog-body">
                <p class="dialog-message">This folder contains prompts. What would you like to do?</p>
                <div class="dialog-option-group">
                    <label class="radio-option">
                        <input type="radio" name="delete-option" value="delete_all" checked>
                        <span class="radio-label option-text-1">Delete folder and all prompts inside it.</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="delete-option" value="move_all">
                        <span class="radio-label option-text-2">Keep prompts and move them to "All Prompts".</span>
                    </label>
                </div>
            </div>
            <div class="prompt-dialog-footer">
                <button class="prompt-btn prompt-btn-secondary cancel-button">Cancel</button>
                <button class="prompt-btn prompt-btn-danger ok-button">Confirm</button>
            </div>
        </div>
    </template>

    <!-- Settings: Appearance Template -->
    <template id="settings-appearance-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Customize the look and feel of the extension.</p>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Theme</span>
                        <span class="description">Choose between light and dark mode.</span>
                    </div>
                    <div class="setting-item-control segmented-control" id="theme-control">
                        <button data-theme="light" title="Light Theme" aria-label="Light theme">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </button>
                        <button data-theme="dark" title="Dark Theme" aria-label="Dark theme">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M21 12.79A9 9 0 1 1 10.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Language</span>
                        <span class="description">Select the display language.</span>
                    </div>
                    <div class="setting-item-control">
                        <select id="language-select" class="styled-select" aria-label="Language selection">
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Prompt Library Zoom</span>
                        <span class="description">Zoom changes only the prompt list and folder list (when expanded).
                            Sections and buttons stay the same size.</span>
                    </div>
                    <div class="setting-item-control">
                        <select id="library-zoom-select" class="styled-select" aria-label="Prompt Library Zoom"
                            style="text-align: center; text-align-last: center;">
                            <option value="80">Extra Compact</option>
                            <option value="90">Compact</option>
                            <option value="100" selected>Normal</option>
                        </select>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Conversation Timeline</span>
                        <span class="description">Show minimap ruler on the right side of AI chat pages</span>
                    </div>
                    <div class="setting-item-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="timeline-enabled-toggle" checked aria-label="Toggle timeline">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Data Template -->
    <template id="settings-data-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Manage your stored prompts and settings.</p>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Storage Usage</span>
                        <span class="description">Space used by your prompts library.</span>
                    </div>
                    <div class="setting-item-control storage-usage-control">
                        <div id="usageText" class="storage-usage-text">Loading...</div>
                        <div class="progress-bar-container">
                            <div id="storage-progress-bar" class="progress-bar-fill"></div>
                            <div class="progress-bar-threshold" style="left: 80%;"></div>
                            <div class="progress-bar-threshold" style="left: 95%;"></div>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Backup & Restore</span>
                        <span class="description">Import or export your prompts and settings.</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button" id="settings-import-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="7 10 12 15 17 10" />
                                <line x1="12" y1="15" x2="12" y2="3" />
                            </svg> Import
                        </button>
                        <button class="action-button" id="settings-export-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="17 8 12 3 7 8" />
                                <line x1="12" y1="3" x2="12" y2="15" />
                            </svg> Export
                        </button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Factory Reset</span>
                        <span class="description">Delete all prompts and reset settings.</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button btn-danger" id="factory-reset-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                aria-hidden="true">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                <line x1="10" y1="11" x2="10" y2="17" />
                                <line x1="14" y1="11" x2="14" y2="17" />
                            </svg> Reset All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Cloud Sync Template -->
    <template id="settings-cloud-sync-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Backup your prompts to the cloud and sync across devices.</p>

                <!-- Authentication Status (shown when NOT authenticated) -->
                <div id="cloud-auth-section" class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Authentication</span>
                        <span class="description">Sign in to sync your prompts across devices</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button" id="cloud-auth-btn">
                            Sign In / Sign Up
                        </button>
                    </div>
                </div>

                <!-- User Info (shown when authenticated) -->
                <div id="cloud-user-info" class="setting-item" style="display: none;">
                    <div class="setting-item-label">
                        <span class="title">Signed in as</span>
                        <span class="description" id="cloud-user-email">user@example.com</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button btn-danger" id="cloud-signout-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                <polyline points="16 17 21 12 16 7" />
                                <line x1="21" y1="12" x2="9" y2="12" />
                            </svg>
                            Sign Out
                        </button>
                    </div>
                </div>

                <!-- Sync Controls (shown when authenticated) -->
                <div id="cloud-sync-controls" style="display: none;">
                    <div class="setting-item">
                        <div class="setting-item-label">
                            <span class="title">Last Sync</span>
                            <span class="description" id="cloud-last-sync">Never</span>
                        </div>
                        <div class="setting-item-control">
                            <button class="action-button" id="cloud-force-sync-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10" />
                                    <polyline points="1 20 1 14 7 14" />
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                                </svg>
                                Sync Now
                            </button>
                        </div>
                    </div>

                    <!-- Sync Statistics (styled like info panel) -->
                    <div class="setting-item" style="margin-top: 16px;">
                        <div class="settings-info-panel" style="padding: 12px 14px; border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                                <svg style="flex-shrink: 0; color: var(--accent-primary); opacity: 0.7;"
                                    xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path
                                        d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z">
                                    </path>
                                </svg>
                                <span class="settings-info-text" style="font-weight: 400; font-size: 0.8125rem;">Sync
                                    Statistics</span>
                            </div>
                            <div class="settings-info-text" style="font-size: 0.75rem; line-height: 1.5;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>Synced folders:</span>
                                    <strong style="font-weight: 500;" id="cloud-sync-folders">0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Synced prompts:</span>
                                    <strong style="font-weight: 500;" id="cloud-sync-prompts">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Information Panel -->
                <div class="setting-item" style="margin-top: 28px;">
                    <div class="settings-info-panel" style="padding: 12px 14px; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                            <svg style="flex-shrink: 0; color: var(--accent-primary); opacity: 0.7;"
                                xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <span class="settings-info-text" style="font-weight: 400; font-size: 0.8125rem;">How Cloud
                                Sync Works</span>
                        </div>
                        <div class="settings-info-text"
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 0.75rem; line-height: 1.5;">
                            <div>
                                <strong style="font-weight: 500;">Features:</strong>
                                <ul style="list-style: none; margin: 4px 0 0 0; padding: 0;">
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>All changes save locally first</li>

                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Works perfectly offline</li>
                                    <li style="display: flex; align-items: center;"><svg width="12" height="12"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Access from any device</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="font-weight: 500;">Security:</strong>
                                <ul style="list-style: none; margin: 4px 0 0 0; padding: 0;">
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Isolated per user account</li>
                                    <li style="display: flex; align-items: center;"><svg width="12" height="12"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>No data sharing</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Danger Zone (Following Brand Guidelines Mockup) -->
                <div class="danger-zone-container"
                    style="margin-top: 24px; border: 1px solid var(--danger, #ef4444); background-color: rgba(239, 68, 68, 0.05); border-radius: var(--radius-md, 8px); padding: var(--space-4, 16px); font-family: 'Open Sans', sans-serif;">
                    <div class="danger-zone-content"
                        style="display: flex; align-items: center; justify-content: space-between; gap: var(--space-4, 16px); min-height: 44px;">
                        <!-- Left: Icon + Danger Zone Label -->
                        <div class="danger-zone-header"
                            style="display: flex; align-items: center; gap: var(--space-2, 8px); min-width: 110px;">
                            <svg class="danger-icon"
                                style="color: var(--danger, #ef4444); width: 16px; height: 16px; flex-shrink: 0; margin-right: var(--space-1, 4px);"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                                </path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            <span class="danger-zone-title"
                                style="color: var(--danger, #ef4444); font-size: 14px; font-weight: 600; white-space: nowrap;">Danger
                                Zone</span>
                        </div>

                        <!-- Center: Reset Info -->
                        <div class="reset-info" style="flex-grow: 1; text-align: left;">
                            <div class="reset-title"
                                style="font-size: 15px; font-weight: 600; color: var(--text-primary); line-height: 1.2;">
                                Reset Cloud Data</div>
                            <div class="reset-description"
                                style="font-size: 13px; color: var(--text-secondary); margin-top: var(--space-1, 4px); line-height: 1.4;">
                                Delete all cloud data and start fresh. Local data is not affected.</div>
                        </div>

                        <!-- Right: Danger Button (NO ICON - as per mockup) -->
                        <button class="btn btn-danger" id="cloud-sync-reset-btn"
                            style="padding: 10px 20px; min-height: 44px; border-radius: var(--radius-md, 8px); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); background: var(--danger, #ef4444); color: #ffffff; border: none; box-shadow: var(--shadow-sm, 0 1px 2px rgba(0, 0, 0, 0.05)); white-space: nowrap;">
                            Reset Cloud Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Shortcuts Template -->
    <template id="settings-shortcuts-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Boost your productivity with keyboard shortcuts.</p>

                <!-- Configure Button -->
                <div class="setting-item" style="margin-top: 16px;">
                    <div class="setting-item-label">
                        <span class="title">Configure Shortcuts</span>
                        <span class="description">Opens Chrome's shortcuts page where you can set your preferred key
                            combinations</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button" id="customize-shortcuts-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Open Shortcuts Page
                        </button>
                    </div>
                </div>

                <!-- Information Panel -->
                <div class="setting-item" style="margin-top: 16px;">
                    <div class="settings-info-panel" style="padding: 12px 14px; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                            <svg style="flex-shrink: 0; color: var(--accent-primary); opacity: 0.7;"
                                xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <span class="settings-info-text" style="font-weight: 400; font-size: 0.8125rem;">About
                                Keyboard Shortcuts</span>
                        </div>
                        <div class="settings-info-text" style="font-size: 0.75rem; line-height: 1.6;">
                            <p style="margin: 0 0 8px 0;">For security reasons, Chrome requires you to manually
                                configure keyboard shortcuts through the official extensions page. This ensures no
                                extension can hijack system shortcuts without your explicit permission.</p>
                            <p style="margin: 0;"><strong style="font-weight: 500;">Available shortcuts:</strong></p>
                            <ul style="margin: 4px 0 0 18px; padding: 0;">

                                <li style="display: flex; align-items: center; margin-bottom: 4px;">
                                    <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round"
                                        style="margin-right: 8px; color: var(--text-secondary);">
                                        <path d="m16 6 4 14"></path>
                                        <path d="M12 6v14"></path>
                                        <path d="M8 8v12"></path>
                                        <path d="M4 4v16"></path>
                                    </svg>
                                    <span><strong>Open Prompt Library</strong> (Ctrl+Shift+A / Cmd+Shift+A) - Quick
                                        access to all your prompts</span>
                                </li>
                                <li style="display: flex; align-items: center;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round"
                                        style="margin-right: 8px; color: var(--text-secondary);">
                                        <path d="M3 12C3 12 5.5 7 9 7C12.5 7 12.5 17 16 17C19.5 17 22 12 22 12" />
                                    </svg>
                                    <span><strong>Open Flow</strong> (Ctrl+Shift+F / Cmd+Shift+F) - Launch the Flow
                                        feature</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Statistics Template -->
    <template id="settings-statistics-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Detailed insights into your prompt usage patterns.</p>
                <div id="statistics-items-container">
                    <!-- Populated by StatisticsManager -->
                </div>
                <div id="most-used-container">
                    <!-- Populated by StatisticsManager -->
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Advanced Template -->
    <template id="settings-advanced-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Control export functionality and available formats.</p>

                <!-- Export Settings -->
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Export</span>
                        <span class="description">Enable or disable export functionality.</span>
                    </div>
                    <div class="setting-item-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="export-enabled-toggle" aria-label="Toggle export">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Export Formats (shown when export is enabled) -->
                <div id="export-formats-setting" style="margin-top: 24px; padding-bottom: 24px; border-bottom: none;">
                    <div style="margin-bottom: 16px;">
                        <h3 style="font-size: 1rem; font-weight: 600; margin: 0 0 4px 0; color: var(--text-primary);">
                            Export Formats</h3>
                        <p style="font-size: 0.875rem; margin: 0; color: var(--text-secondary);">Enable and reorder
                            export formats. Drag to reorder.</p>
                    </div>
                    <div id="export-formats-list" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Troubleshooting Template -->
    <template id="settings-troubleshooting-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description" style="font-size: 0.875rem; margin-bottom: 20px;">Collect system logs to help
                    debug issues. Logs are packaged into a ZIP file for easy sharing.</p>

                <!-- Verbosity Selection - Dropdown with descriptions below -->
                <div class="setting-item" style="margin-top: 0;">
                    <div class="setting-item-label">
                        <span class="title">Log Detail Level</span>
                        <span class="description">Select the level of diagnostic information to collect</span>
                    </div>
                    <div class="setting-item-control">
                        <select id="verbosity-select" class="styled-select" aria-label="Log detail level selection">
                            <option value="standard">Standard</option>
                            <option value="detailed">Detailed</option>
                        </select>
                    </div>
                </div>

                <!-- Verbosity Descriptions -->
                <div style="margin-top: 12px;">
                    <div style="margin-bottom: 12px;">
                        <div
                            style="font-weight: 600; margin-bottom: 4px; font-size: 0.875rem; color: var(--text-primary);">
                            Standard (recommended)</div>
                        <div style="font-size: 0.8125rem; color: var(--text-secondary); line-height: 1.5;">Captures
                            errors, warnings, and key events. Best for common troubleshooting.</div>
                    </div>
                    <div style="padding-bottom: 12px; border-bottom: 1px solid var(--border-color);">
                        <div
                            style="font-weight: 600; margin-bottom: 4px; font-size: 0.875rem; color: var(--text-primary);">
                            Detailed (advanced)</div>
                        <div style="font-size: 0.8125rem; color: var(--text-secondary); line-height: 1.5;">Includes
                            verbose debug logs. Use when requested by support.</div>
                    </div>
                </div>

                <!-- Collection Controls -->
                <div class="setting-item" style="margin-top: 20px;">
                    <div class="setting-item-label">
                        <span class="description" id="collection-status"
                            style="font-size: 0.8125rem; color: var(--text-secondary);">Click start, reproduce the
                            issue, then click stop</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button" id="collect-logs-btn"
                            style="min-width: 180px; padding: 10px 20px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true" id="collect-btn-icon">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            <span id="collect-btn-text">Start Collecting</span>
                        </button>
                    </div>
                </div>

                <!-- Warning Phase Display (shown when < 30 seconds remaining) -->
                <div class="setting-item" id="warning-container" style="display: none; margin-top: 16px;">
                    <div class="setting-item-label">
                        <span class="title" style="color: #f59e0b; font-size: 0.875rem; font-weight: 500;">âš ï¸
                            Auto-stopping in <span id="warning-countdown">30</span>s</span>
                        <span class="description" style="font-size: 0.75rem;">Click stop if issue captured, or extend
                            time</span>
                    </div>
                    <div class="setting-item-control" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="action-button" id="extend-btn"
                            style="min-width: 150px; padding: 8px 16px; font-size: 0.8125rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span>Add 2 Minutes</span>
                        </button>
                    </div>
                </div>

                <!-- Progress Bar (shown during warning phase) -->
                <div id="progress-container"
                    style="display: none; margin-top: 12px; padding: 10px 12px; background: rgba(0, 0, 0, 0.02); border: 1px solid rgba(0, 0, 0, 0.06); border-radius: 6px;">
                    <div style="margin-bottom: 6px; font-size: 0.75rem; color: var(--text-secondary);">Collection
                        progress</div>
                    <div
                        style="width: 100%; height: 6px; background: var(--bg-primary); border-radius: 3px; overflow: hidden;">
                        <div id="progress-bar"
                            style="height: 100%; background: var(--accent-primary); width: 0%; transition: width 1s linear;">
                        </div>
                    </div>
                </div>

                <!-- Privacy/Information Panel -->
                <div class="setting-item" style="margin-top: 28px;">
                    <div class="settings-info-panel" style="padding: 12px 14px; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                            <svg style="flex-shrink: 0; color: var(--accent-primary); opacity: 0.7;"
                                xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <span class="settings-info-text" style="font-weight: 400; font-size: 0.8125rem;">What's
                                included in the log package</span>
                        </div>
                        <div class="settings-info-text"
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 0.75rem; line-height: 1.5;">
                            <div>
                                <strong style="font-weight: 500;">Included:</strong>
                                <ul style="list-style: none; margin: 4px 0 0 0; padding: 0;">
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Browser type and version</li>
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Screen size and viewport</li>
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Application logs and errors</li>
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Extension console logs</li>
                                    <li style="display: flex; align-items: center;"><svg width="12" height="12"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #10B981;">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>Current settings (sanitized)</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="font-weight: 500;">Not included:</strong>
                                <ul style="list-style: none; margin: 4px 0 0 0; padding: 0;">
                                    <li style="display: flex; align-items: center; margin-bottom: 4px;"><svg width="12"
                                            height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #EF4444;">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>Passwords or API keys</li>
                                    <li style="display: flex; align-items: center;"><svg width="12" height="12"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="margin-right: 6px; flex-shrink: 0; color: #EF4444;">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>Personal data or file contents</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Settings: Flow Template -->
    <template id="settings-flow-template">
        <div class="settings-section">
            <div class="settings-group">
                <p class="description">Customize AI ChatWorks Flow (Ctrl+Shift+F / Cmd+Shift+F) - your Spotlight-style
                    command palette.</p>

                <!-- Display Limits -->
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Maximum Prompts to Show</span>
                        <span class="description">Number of recent prompts displayed in Flow</span>
                    </div>
                    <div class="setting-item-control">
                        <div class="custom-stepper" style="display: inline-flex; gap: 2px; align-items: center;">
                            <button type="button" class="stepper-btn stepper-minus" data-target="flow-max-prompts"
                                data-min="3" data-max="10"
                                style="width: 22px; height: 22px; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: color 0.2s;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <div
                                style="min-width: 32px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 500; color: var(--text-primary);">
                                <span id="flow-max-prompts-value">5</span>
                            </div>
                            <button type="button" class="stepper-btn stepper-plus" data-target="flow-max-prompts"
                                data-min="3" data-max="10"
                                style="width: 22px; height: 22px; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: color 0.2s;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                        <input type="hidden" id="flow-max-prompts" value="5">
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Maximum Actions to Show</span>
                        <span class="description">Number of quick actions displayed in Flow</span>
                    </div>
                    <div class="setting-item-control">
                        <div class="custom-stepper" style="display: inline-flex; gap: 2px; align-items: center;">
                            <button type="button" class="stepper-btn stepper-minus" data-target="flow-max-actions"
                                data-min="3" data-max="10"
                                style="width: 22px; height: 22px; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: color 0.2s;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <div
                                style="min-width: 32px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 500; color: var(--text-primary);">
                                <span id="flow-max-actions-value">5</span>
                            </div>
                            <button type="button" class="stepper-btn stepper-plus" data-target="flow-max-actions"
                                data-min="3" data-max="10"
                                style="width: 22px; height: 22px; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: color 0.2s;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                        <input type="hidden" id="flow-max-actions" value="5">
                    </div>
                </div>

                <!-- Search Options -->
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Search Options</span>
                        <span class="description">Choose what Flow searches when you type a query</span>
                    </div>
                    <div class="setting-item-control" style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <label class="checkbox-option"
                            style="display: inline-flex; align-items: center; gap: 8px; padding: 9px 17px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; white-space: nowrap; transition: all 0.2s ease;">
                            <input type="checkbox" id="flow-search-current-chat" checked
                                style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; accent-color: var(--accent-primary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" style="flex-shrink: 0;">
                                <path
                                    d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                            </svg>
                            <span style="font-weight: 500; font-size: 14px; color: var(--text-primary);">Current
                                chat</span>
                        </label>
                        <label class="checkbox-option"
                            style="display: inline-flex; align-items: center; gap: 8px; padding: 9px 17px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; white-space: nowrap; transition: all 0.2s ease;">
                            <input type="checkbox" id="flow-search-history" checked
                                style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; accent-color: var(--accent-primary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" style="flex-shrink: 0;">
                                <path d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span style="font-weight: 500; font-size: 14px; color: var(--text-primary);">Entire chat
                                history</span>
                        </label>
                    </div>
                </div>

                <!-- Actions Enable/Disable -->
                <div class="setting-item" style="display: flex; flex-direction: column; align-items: stretch;">
                    <div class="setting-item-label" style="width: 100%; max-width: none; margin-bottom: 12px;">
                        <span class="title">Enabled Actions</span>
                        <span class="description">Choose which quick actions appear in Flow. Drag to reorder.</span>
                    </div>
                    <div class="setting-item-control" style="width: 100%;">
                        <div id="flow-actions-list" class="checkbox-options"
                            style="display: flex; flex-wrap: wrap; gap: 12px; width: 100%;">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Reset Button -->
                <div class="setting-item">
                    <div class="setting-item-label">
                        <span class="title">Reset Flow Settings</span>
                        <span class="description">Restore Flow to default configuration</span>
                    </div>
                    <div class="setting-item-control">
                        <button class="action-button" id="flow-reset-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" aria-hidden="true">
                                <path d="M23 4v6h-6M1 20v-6h6" />
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                            </svg>
                            Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>
</div>

<!-- ========================================
     AI CHATWORKS FLOW - COMMAND PALETTE
     Separate overlay - sibling to unified window
     ======================================== -->

<div id="ai-chatworks-flow-overlay" class="flow-overlay ai-chatworks-scope">
    <div class="flow-palette">
        <!-- Header with Search -->
        <div class="flow-header">
            <div class="flow-search-container">
                <svg class="flow-search-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M3 12C3 12 5.5 7 9 7C12.5 7 12.5 17 16 17C19.5 17 22 12 22 12" />
                </svg>
                <input type="text" id="flow-search-input" class="flow-search-input" placeholder="Search everything..."
                    autocomplete="off" spellcheck="false">
            </div>
            <button id="flow-favorites-toggle" class="flow-favorites-toggle" type="button" title="Filter favorites">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon
                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                    </polygon>
                </svg>
            </button>
            <button id="flow-mode-toggle" class="flow-mode-toggle" type="button">
                Actions
            </button>
        </div>

        <!-- Results Container -->
        <div class="flow-results" id="flow-results-container">
            <!-- Results populated by JavaScript -->
        </div>

        <!-- Footer with Keyboard Hints -->
        <div class="flow-footer">
            <span class="flow-hint">
                <kbd>â†‘</kbd> <kbd>â†“</kbd> navigate
            </span>
            <span class="flow-hint">
                <kbd>â†µ</kbd> select
            </span>
            <span class="flow-hint">
                <kbd>esc</kbd> close
            </span>
        </div>
    </div>
</div>

<!-- Floating Stop Log Collection Button (shown only when collection is active) -->
<button id="ai-chatworks-stop-log-collection" class="ai-chatworks-scope" style="
    display: none;
    position: fixed;
    bottom: 90px;
    right: 24px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #ef4444;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 999999;
    transition: all 0.2s ease;
    animation: pulse 2s ease-in-out infinite;
" title="Stop & Download Logs">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display: block; margin: auto;">
        <rect x="6" y="4" width="4" height="16"></rect>
        <rect x="14" y="4" width="4" height="16"></rect>
    </svg>
</button>

<style>
    @keyframes pulse {

        0%,
        100% {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4), 0 0 0 0 rgba(239, 68, 68, 0.7);
        }

        50% {
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4), 0 0 0 8px rgba(239, 68, 68, 0);
        }
    }

    #ai-chatworks-stop-log-collection:hover {
        transform: scale(1.05);
        background: #dc2626;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    #ai-chatworks-stop-log-collection:active {
        transform: scale(0.95);
    }
</style>